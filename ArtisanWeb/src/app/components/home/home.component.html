<div class="w-full max-w-5xl px-4">
  <div class="mt-6 mb-4">
    <h1 class="text-2xl font-semibold tracking-tight text-gray-900">
      {{ "orders.title" | translate }}
    </h1>
    <p class="mt-1 text-sm text-gray-600">
      {{ "orders.subtitle" | translate }}
      <span *ngIf="login" class="text-gray-500">
        Â· {{ "home.greeting" | translate : { login: login } }}
      </span>
    </p>
  </div>

  <div
    class="bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden"
  >
    <!-- Toolbar -->
    <div class="p-4 border-b border-gray-200 bg-gray-50/50">
      <div class="flex flex-col gap-3 sm:flex-row sm:items-end sm:gap-4">
        <label class="block flex-1">
          <span class="block text-xs font-medium text-gray-600 mb-1">
            {{ "orders.search" | translate }}
          </span>
          <input
            [(ngModel)]="search"
            (keyup.enter)="loadOrders()"
            type="text"
            [placeholder]="'orders.searchPlaceholder' | translate"
            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500"
          />
        </label>

        <label class="block sm:w-56">
          <span class="block text-xs font-medium text-gray-600 mb-1">
            {{ "orders.status" | translate }}
          </span>
          <select
            [(ngModel)]="status"
            (change)="loadOrders()"
            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500"
          >
            <option value="">{{ "orders.statusAll" | translate }}</option>
            <option *ngFor="let s of statuses" [value]="s">
              {{ statusLabel(s) }}
            </option>
          </select>
        </label>

        <label class="block sm:w-56">
          <span class="block text-xs font-medium text-gray-600 mb-1">
            {{ "orders.sort" | translate }}
          </span>
          <select
            [(ngModel)]="sort"
            (change)="loadOrders()"
            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500"
          >
            <option *ngFor="let opt of sortOptions" [value]="opt.value">
              {{ opt.labelKey | translate }}
            </option>
          </select>
        </label>

        <div class="flex gap-2 sm:justify-end">
          <button
            (click)="loadOrders()"
            class="px-3 py-2 text-sm font-medium rounded-lg bg-blue-600 text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500/30"
          >
            {{ "orders.refresh" | translate }}
          </button>
          <button
            (click)="clearFilters()"
            class="px-3 py-2 text-sm font-medium rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-400/20"
          >
            {{ "orders.reset" | translate }}
          </button>
        </div>
      </div>
    </div>

    <!-- States -->
    <div *ngIf="loadingOrders" class="p-6">
      <div class="animate-pulse space-y-3">
        <div class="h-4 bg-gray-200 rounded w-2/3"></div>
        <div class="h-4 bg-gray-200 rounded w-1/2"></div>
        <div class="h-4 bg-gray-200 rounded w-3/4"></div>
      </div>
    </div>

    <div *ngIf="!loadingOrders && ordersError" class="p-6">
      <div
        class="rounded-lg border border-red-200 bg-red-50 text-red-800 px-4 py-3 text-sm flex items-start justify-between gap-4"
      >
        <div class="min-w-0">
          <div class="font-medium">{{ "orders.error" | translate }}</div>
          <div class="mt-1 break-words">{{ ordersError }}</div>
        </div>
        <button
          (click)="loadOrders()"
          class="shrink-0 px-3 py-2 text-sm font-medium rounded-lg bg-red-600 text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500/30"
        >
          {{ "orders.retry" | translate }}
        </button>
      </div>
    </div>

    <div *ngIf="!loadingOrders && !ordersError && orders.length === 0" class="p-6">
      <div class="text-sm text-gray-600">{{ "orders.empty" | translate }}</div>
    </div>

    <!-- Table -->
    <div *ngIf="!loadingOrders && !ordersError && orders.length > 0">
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead class="bg-white">
            <tr class="text-left text-xs font-medium text-gray-600">
              <th class="px-4 py-3 border-b border-gray-200">
                {{ "orders.tableId" | translate }}
              </th>
              <th class="px-4 py-3 border-b border-gray-200">
                {{ "orders.tableUser" | translate }}
              </th>
              <th class="px-4 py-3 border-b border-gray-200">
                {{ "orders.tableStatus" | translate }}
              </th>
              <th class="px-4 py-3 border-b border-gray-200">
                {{ "orders.tableDescription" | translate }}
              </th>
              <th class="px-4 py-3 border-b border-gray-200">
                {{ "orders.tableCreated" | translate }}
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100">
            <tr
              *ngFor="let order of orders; trackBy: trackByOrderId"
              class="hover:bg-gray-50/70"
            >
              <td class="px-4 py-3 text-gray-900 font-medium">
                #{{ order.id }}
              </td>
              <td class="px-4 py-3 text-gray-700">
                {{ userLabel(order) }}
              </td>
              <td class="px-4 py-3">
                <span
                  class="inline-flex items-center rounded-full border px-2.5 py-1 text-xs font-medium"
                  [ngClass]="statusBadgeClass(order.status)"
                >
                  {{ statusLabel(order.status) }}
                </span>
              </td>
              <td class="px-4 py-3 text-gray-700 max-w-[28rem]">
                <div class="truncate" [title]="order.description || ''">
                  {{ order.description || ("orders.emptyValue" | translate) }}
                </div>
              </td>
              <td class="px-4 py-3 text-gray-600 whitespace-nowrap">
                {{ order.createdAt | date : "medium" }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
