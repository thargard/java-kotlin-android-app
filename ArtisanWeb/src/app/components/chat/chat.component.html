<!-- src/app/components/chat/chat.component.html -->

<div class="chat-container">
  <!-- Заголовок чата -->
  <div class="chat-header">
    <button class="back-button" (click)="goBack()">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
    </button>
    <div class="header-info">
      <h2>{{ otherUserName }}</h2>
    </div>
  </div>

  <!-- Область сообщений -->
  <div class="messages-area" #messagesContainer>
    <!-- Загрузка -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <p>Загрузка сообщений...</p>
    </div>

    <!-- Ошибка -->
    <div *ngIf="error && !loading" class="error-state">
      <p>{{ error }}</p>
      <button class="retry-button" (click)="loadConversation()">
        Попробовать снова
      </button>
    </div>

    <!-- Сообщения -->
    <div *ngIf="!loading && !error" class="messages-list">
      <!-- Пустое состояние -->
      <div *ngIf="messages.length === 0" class="empty-chat">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
        <p>Начните разговор</p>
      </div>

      <!-- Список сообщений -->
      <div *ngFor="let message of messages; let i = index" class="message-wrapper">
        <!-- Разделитель дат -->
        <div *ngIf="shouldShowDateSeparator(i)" class="date-separator">
          <span>{{ formatDate(message.createdAt) }}</span>
        </div>

        <!-- Сообщение -->
        <div 
          class="message"
          [class.my-message]="isMyMessage(message)"
          [class.other-message]="!isMyMessage(message)">
          
          <div class="message-content">
            <p>{{ message.content }}</p>
            <div class="message-meta">
              <span class="message-time">{{ formatTime(message.createdAt) }}</span>
              <span *ngIf="isMyMessage(message)" class="message-status">
                <svg *ngIf="message.isRead" class="read-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="20 6 9 17 4 12"></polyline>
                  <polyline points="20 6 9 17"></polyline>
                </svg>
                <svg *ngIf="!message.isRead" class="sent-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Область ввода -->
  <div class="input-area">
    <form class="message-form" (ngSubmit)="sendMessage()">
      <textarea
        [(ngModel)]="newMessage"
        name="message"
        placeholder="Введите сообщение..."
        rows="1"
        class="message-input"
        [disabled]="sending"
        (keydown.enter)="onEntryKey($event)">
      </textarea>
      <button 
        type="submit" 
        class="send-button"
        [disabled]="!newMessage.trim() || sending">
        <svg *ngIf="!sending" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="22" y1="2" x2="11" y2="13"></line>
          <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
        <div *ngIf="sending" class="button-spinner"></div>
      </button>
    </form>
  </div>
</div>